# terraform-azure-mcaf-container-registry
Terraform module to generate Azure Container Registry

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                      | Version       |
| ------------------------------------------------------------------------- | ------------- |
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.8        |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm)       | >= 4, < 5.0.0 |

## Providers

| Name                                                          | Version       |
| ------------------------------------------------------------- | ------------- |
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | >= 4, < 5.0.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                  | Type        |
| ----------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [azurerm_container_registry.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/container_registry)                 | resource    |
| [azurerm_monitor_diagnostic_setting.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_diagnostic_setting) | resource    |
| [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group)                         | resource    |
| [azurerm_role_assignment.acr](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                        | resource    |
| [azurerm_key_vault_key.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/key_vault_key)                        | data source |
| [azurerm_user_assigned_identity.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/user_assigned_identity)      | data source |

## Inputs

| Name                                                                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Default | Required |
| -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- | :------: |
| <a name="input_acr"></a> [acr](#input\_acr)                                                        | This object describes the configuration for an Azure Container Registry.<br><br>- `name` - (Optional) Specifies the name of the Container Registry. Changing this forces a new resource to be created.<br>- `resource_group_name` - (Optional) The name of the resource group in which to create the Container Registry. Changing this forces a new resource to be created.<br>- `location` - (Optional) Specifies the supported Azure location where the resource exists. Changing this forces a new resource to be created.<br>- `sku` - (Optional) The SKU name of the the Container Registry. Possible values are `Basic`, `Premium`.<br>- `admin_enabled` - (Optional) Specifies whether the admin user is enabled. Defaults to `false`.<br>- `anonymous_pull_enabled` - (Optional) Specifies whether anonymous pull is enabled. Defaults to `false`.<br>- `quarantine_policy_enabled` - (Optional) Specifies whether quarantine policy is enabled. Defaults to `false`.<br>- `public_network_access_enabled` - (Optional) Specifies whether public network access is enabled. Defaults to `false`.<br>- `export_policy_enabled` - (Optional) Specifies whether export policy is enabled. Defaults to `false`.<br>- `retention_policy_in_days` - (Optional) Specifies the number of days to retain untagged manifests. Defaults to `7`.<br>- `network_bypass` - (Optional) Specifies the network bypass options. Possible values are `AzureServices`, `None`, and `ServiceEndpoints`.<br>- `managed_identities` - (Optional) Specifies the Managed Identity configuration. The following properties can be specified:<br>  - `system_assigned` - (Optional) Specifies if the System Assigned Managed Identity should be enabled. Defaults to `false`.<br>  - `user_assigned_resource_ids` - (Optional) Specifies a list of User Assigned Managed Identity resource IDs to be assigned to this resource. Defaults to `[]`.<br>- `network_rule_set` - (Optional) Specifies the network rule set configuration. The following properties can be specified:<br>  - `default_action` - (Optional) Specifies the default action for network rule set. Possible values are `Allow` and `Deny`. Defaults to `Deny`.<br>  - `ip_rule` - (Optional) Specifies the IP rule configuration. The following properties can be specified:<br>    - `action` - (Optional) Specifies the action for the IP rule. Possible values are `Allow` and `Deny`. Defaults to `Allow`.<br>    - `ip_range` - (Required) Specifies the IP range for the IP rule.<br>- `zone_redundancy_enabled` - (Optional) Specifies whether zone redundancy is enabled. Defaults to `tru`.<br>- `role_assignments` - (Optional) Specifies the role assignments for the Container Registry. The following properties can be specified:<br>  - `principal_id` - (Required) The ID of the principal to assign the role to.<br>  - `role` - (Required) The role to assign to the principal. Possible values are `AcrPull`, `AcrPush`<br>- `tags` - (Optional) A mapping of tags to assign to the resource.<br><br>Example Inputs:<pre>hcl<br><br>module "acr" {<br>  source = "somelocation"<br><br>  acr = {<br>    name                          = "myacr123"<br>    resource_group_name           = "myrg"<br>    location                      = "germanywestcentral"<br>    admin_enabled                 = false<br>    public_network_access_enabled = false<br>    network_rule_bypass_option    = "AzureServices"<br>  }<br>  tags = {<br>    "deploymentmodel" = "Terraform"<br>  }<br>}</pre>} | <pre>object({<br>    name                          = optional(string)<br>    resource_group_name           = optional(string)<br>    location                      = optional(string)<br>    sku                           = optional(string, "Premium")<br>    anonymous_pull_enabled        = optional(bool, false)<br>    quarantine_policy_enabled     = optional(bool, false)<br>    admin_enabled                 = optional(bool, false)<br>    public_network_access_enabled = optional(bool, false)<br>    enable_trust_policy           = optional(bool, false)<br>    export_policy_enabled         = optional(bool, false)<br>    retention_policy_in_days      = optional(number, 7)<br>    network_rule_bypass_option    = optional(string, "None")<br>    managed_identities = optional(object({<br>      system_assigned            = optional(bool, false)<br>      user_assigned_resource_ids = optional(set(string), [])<br>    }), {})<br>    network_rule_set = optional(object({<br>      default_action = optional(string, "Deny")<br>      ip_rule = optional(list(object({<br>        # since the `action` property only permits `Allow`, this is hard-coded.<br>        action   = optional(string, "Allow")<br>        ip_range = string<br>      })), [])<br>    }), null)<br>    georeplications = optional(list(object({<br>      location                  = string<br>      regional_endpoint_enabled = optional(bool, true)<br>      zone_redundancy_enabled   = optional(bool, true)<br>      tags                      = optional(map(any), null)<br>    })), [])<br>    zone_redundancy_enabled = optional(bool, true)<br>    role_assignments = optional(map(object({<br>      principal_id = string<br>      role         = string<br>    })))<br>    tags = optional(map(string))<br>  })</pre> | `{}`    |    no    |
| <a name="input_customer_managed_key"></a> [customer\_managed\_key](#input\_customer\_managed\_key) | A map of diagnostic settings to create on the Key Vault. The map key is deliberately arbitrary to avoid issues where map keys maybe unknown at plan time.<br>Controls the Customer managed key configuration on this resource. The following properties can be specified:<br>- `key_vault_resource_id` - (Required) Resource ID of the Key Vault that the customer managed key belongs to.<br>- `key_name` - (Required) Specifies the name of the Customer Managed Key Vault Key.<br>- `key_version` - (Optional) The version of the Customer Managed Key Vault Key.<br>- `user_assigned_identity` - (Optional) The User Assigned Identity that has access to the key.<br>  - `resource_id` - (Required) The resource ID of the User Assigned Identity that has access to the key.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | <pre>object({<br>    key_vault_resource_id = string<br>    key_name              = string<br>    key_version           = optional(string, null)<br>    user_assigned_identity = optional(object({<br>      resource_id = string<br>    }), null)<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `null`  |    no    |
| <a name="input_diagnostic_settings"></a> [diagnostic\_settings](#input\_diagnostic\_settings)      | A map of diagnostic settings to create on the Container Registry. The map key is deliberately arbitrary to avoid issues where map keys maybe unknown at plan time.<br><br>  - `name` - (Optional) The name of the diagnostic setting. One will be generated if not set, however this will not be unique if you want to create multiple diagnostic setting resources.<br>  - `log_categories` - (Optional) A set of log categories to send to the log analytics workspace. Defaults to `[]`.<br>  - `log_groups` - (Optional) A set of log groups to send to the log analytics workspace. Defaults to `["allLogs"]`.<br>  - `metric_categories` - (Optional) A set of metric categories to send to the log analytics workspace. Defaults to `["AllMetrics"]`.<br>  - `log_analytics_destination_type` - (Optional) The destination type for the diagnostic setting. Possible values are `Dedicated` and `AzureDiagnostics`. Defaults to `Dedicated`.<br>  - `workspace_resource_id` - (Optional) The resource ID of the log analytics workspace to send logs and metrics to.<br>  - `storage_account_resource_id` - (Optional) The resource ID of the storage account to send logs and metrics to.<br>  - `event_hub_authorization_rule_resource_id` - (Optional) The resource ID of the event hub authorization rule to send logs and metrics to.<br>  - `event_hub_name` - (Optional) The name of the event hub. If none is specified, the default event hub will be selected.<br>  - `marketplace_partner_resource_id` - (Optional) The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic LogsLogs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <pre>map(object({<br>    name                                     = optional(string, null)<br>    log_categories                           = optional(set(string), [])<br>    log_groups                               = optional(set(string), ["allLogs"])<br>    metric_categories                        = optional(set(string), ["AllMetrics"])<br>    log_analytics_destination_type           = optional(string, "Dedicated")<br>    workspace_resource_id                    = optional(string, null)<br>    storage_account_resource_id              = optional(string, null)<br>    event_hub_authorization_rule_resource_id = optional(string, null)<br>    event_hub_name                           = optional(string, null)<br>    marketplace_partner_resource_id          = optional(string, null)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `{}`    |    no    |
| <a name="input_location"></a> [location](#input\_location)                                         | Azure region where the resource should be deployed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `null`  |    no    |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)    | The name of the resource group in which to create the Container Registry.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `null`  |    no    |
| <a name="input_tags"></a> [tags](#input\_tags)                                                     | A map of tags to assign to the resource.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `{}`    |    no    |

## Outputs

| Name                                                                                                                                                              | Description                                                               |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| <a name="output_azure_container_registry_admin_password"></a> [azure\_container\_registry\_admin\_password](#output\_azure\_container\_registry\_admin\_password) | n/a                                                                       |
| <a name="output_azure_container_registry_admin_username"></a> [azure\_container\_registry\_admin\_username](#output\_azure\_container\_registry\_admin\_username) | n/a                                                                       |
| <a name="output_login_server"></a> [login\_server](#output\_login\_server)                                                                                        | The login server of the parent resource.                                  |
| <a name="output_name"></a> [name](#output\_name)                                                                                                                  | The name of the parent resource.                                          |
| <a name="output_resource"></a> [resource](#output\_resource)                                                                                                      | This is the full output for the resource.                                 |
| <a name="output_resource_id"></a> [resource\_id](#output\_resource\_id)                                                                                           | The resource id for the parent resource.                                  |
| <a name="output_system_assigned_mi_principal_id"></a> [system\_assigned\_mi\_principal\_id](#output\_system\_assigned\_mi\_principal\_id)                         | The system assigned managed identity principal ID of the parent resource. |
<!-- END_TF_DOCS -->

## License

**Copyright:** Schuberg Philis

```text
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
```
